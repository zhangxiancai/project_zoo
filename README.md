# 南通消防用品检测和识别算法训练说明文档

## 说明
消防用品自动识别技术有助于高效管理众多消防用品。本文档介绍南通消防物品检测和识别项目中的检测和识别模型的实现方法。摄像头垂直向下拍摄放在桌子上的消防物品，拍摄的图片输入检测模型，检测模型计算输出检测框，然后裁剪图片，裁剪的图片输入分类模型，计算输出物品类别。在真实场景中采集了114类14000+张图片，训练得到检测模型 yolov5n-0.5和分类模型 resnet18。实验表明，检测和识别模型可识别114种消防物品，在测试集上的准确率可达99.5%。

```
 {0: '65水带', 1: '80水带', 2: '多功能消防水枪', 3: '黄色消防头盔', 4: '空呼气瓶9L', 5: '灭火防护服',
             6: '灭火防护手套', 7: '灭火防护靴', 8: '消防安全腰带', 9: '泡沫枪PQ6', 10: '抢险救援服',
             11: '抢险救援头盔', 12: '抢险救援靴', 13: '三分水器', 14: '水域救援头盔', 15: '水域救援靴',
             16: '水域漂浮背心', 17: '消防栓扳手', 18: '新款黄色消防头盔', 19: '液压剪', 20: '液压救援顶杆',
             21: '正压式呼吸面罩', 22: '直流水枪', 23: '止水器', 24: '80公转80公转接头', 25: 'PQ8泡沫枪',
             26: 'PQ16泡沫枪', 27: '防高温手套', 28: '隔热服', 29: '灭火防护头套', 30: '轻型防化服',
             31: '消防员二类吊带', 32: '消防员接触式送受话器', 33: '消防员三类吊带', 34: '便携式移动消防灯组', 35: '阀门堵漏套具',
             36: '非接触式红外测温仪', 37: '隔离警示带', 38: '呼吸器背架', 39: '混凝土切割锯', 40: '捆绑式堵漏气垫',
             41: '炮口', 42: '无齿锯', 43: '消防专用救生衣', 44: '移动消防水炮', 45: '6.8L正压式呼吸器',
             46: '大力剪', 47: '地下消火栓扳手', 48: '二分水器', 49: '红色消防头盔(全盔)', 50: '黄色消防头盔(全盔)',
             51: '撬棍', 52: '铁锹', 53: '消防锤', 54: '消防尖斧', 55: '消防平斧',
             56: '滤水器', 57: '80母转80公转接头', 58: '冲击钻', 59: '机动链锯', 60: '闪光警示灯',
             61: '水质分析仪', 62: '电动顶杆', 63: '多功能担架', 64: '钢丝绳速差器', 65: '雷达生命探测仪',
             66: '外封式堵漏袋', 67: '消防救生照明线', 68: '小孔堵漏枪', 69: '折叠式担架', 70: '注入式堵漏工具',
             71: '背负式吸水雾', 72: '防静电内衣', 73: '呼救器后场接收装置', 74: '激光测距仪', 75: '木制堵漏楔',
             76: '热成像仪', 77: '手持扩音器', 78: '无火花工具', 79: '无线智能呼救器', 80: '消防阻燃毛衣',
             81: '防爆手持电台', 82: '过滤式消防自救呼吸器', 83: '混凝土切割锯片', 84: '救生抛投器', 85: '军事毒剂侦检仪',
             86: '灭火毯', 87: '手动破拆工具组', 88: '头骨通讯装置', 89: '无齿锯片', 90: '无线复合气体探测仪',
             91: '消防腰斧', 92: '消防员呼救器', 93: '医疗箱', 94: '移车器', 95: '移动照明灯',
             96: '有毒有害物质识别仪', 97: '自救安全绳(8毫米)', 98: '自喷荧光漆', 99: '避火服', 100: '便携式毁锁器',
             101: '单人洗消帐篷', 102: '手动液压千斤顶', 103: '双轮异向切割锯', 104: '四合一气体检测仪', 105: '液压开门器',
             106: '防爆照明灯', 107: '护目镜', 108: '警戒标志杆', 109: '救生缓降器', 110: '绝缘剪断钳',
             111: '抢险救援手套', 112: '危险警示牌', 113: '无人机'}
```




## 仓库
-  https://gitlab.deepcam.cn/deeplearning/fire-equipment-demo

## 数据
-  地址：192.168.0.254:/home/xiancai/DATA/FIRE_DATA
- 消防检测和识别数据集更新记录

## 仓库目录格式
- 总的目录
```
.
├── detect_classify                   ----发布的检测和识别接口
├── firecontrol_classification        ----训练识别模型的相关代码
├── firecontrol_detection             ----训练检测模型的相关代码
├── test                              ----测试代码
└── myutil.py                         ----数据处理代码
```





##环境
- 参考requirements.txt文件，使用pip：
```
pip install -r requirements.txt
# python>=3.7
# torch>=1.7
```


## 消防检测模型实现流程
- 处理原始数据，得到消防检测数据集，数据集保存在../DATA/FIRE_DATA/fire_detect_dataset/

```
python3 myutil.py #处理原始数据
```
- 训练模型，训练的模型保存在firecontrol_detection/run/train文件夹里

```
cd firecontrol_detection
vim firecontrol_detection/data/firecontrol.yaml #修改数据集配置文件
python3 train.py 
```
- 检测，检测的结果保存在firecontrol_detection/run/detect文件夹里：

```
cd firecontrol_detection
python3 detect.py 
# 修改detect文件中weights参数（模型）
# 修改detect文件中source参数（图片或者文件夹）
```


- pytorch模型转为onnx模型，结果保存在pytorch模型目录下
```
cd firecontrol_detection
python3 models/export.py

# 修改export文件中weights参数（模型）
```



## 消防识别模型实现流程
- 处理原始数据，得到消防识别数据集， 数据集保存在../DATA/FIRE_DATA/fire_classify_dataset/

```
python3 myutil.py #处理原始数据
```
- 训练模型，训练的模型保存在firecontrol_classification/checkpoints文件夹里

```
cd firecontrol_classification
python3 train.py 
```
- pytorch模型转为onnx模型

```
cd firecontrol_classification
python3 pytorch2onnx.py
```
## 测试
- 统计识别模型在各种消防物品上的精度

```
cd test
python3 classify.py
# 修改classify.py文件中cls_model_address参数（识别模型）
# 修改classify.py文件中data参数
```
- 统计检测和识别模型在各种消防物品上的精度

```
cd test
python3 detect_classify.py
# 修改classify.py文件中det_model_address参数（检测模型）
# 修改classify.py文件中data参数（文件夹）
```
## 性能
- 可检测并识别114种消防物品
- 在数据集上的测试精度为99.5%

## 模型
- 检测模型使用 yolov5n-0.5，已发布的模型保存在firecontrol_detection/Result/
- 识别模型使用 resnet18，已发布的模型保存在firecontrol_classification/Result/

